# 概要
兵ズにおけるゲーム進行に関わる通信プロトコルについて規定する
（より基本的な通信プロトコルの規定は別途）。

# データ内容
1単位に1つの改行を含まないJSON Objectを送る。

## JSONについて
JSONは構造化されたデータを記述する形式の1つ。
JavaScriptをはじめ、多くのプログラミング言語で独自でパーサを容易することなく、そのまま解釈することができる。

# プレイヤーJSON通信フロー
サーバとクライアントの通信確立後の通信順序を規定する。
通信の順序は下の図の通り(「←←← (JSONデータ名) ←←←」で1単位のデータを送信)。

![画像が見つかりません。](https://github.com/nishinoueclab/heis/blob/master/doc/game_flow.png)

# 送受信するJSONの内容
各通信で送信すべきJSONの内容を規定する。

## クライアントが送信するもの
### 行動JSON (Action JSON)
| JSON key  | 型     | 必須 | 値の説明      |
|-----------|--------|------|---------------|
| turn_team | 文字列 | ○    | チーム名      |
| contents  | 配列   | ○    | 行動の内容    |
|  　unit_id | 文字列 | ○    | ユニットのid  |
|   　　to      | オブジェクト |      |               |
|     　　　x     | 数値   | ○    | 移動先のx座標 |
|     　　　y     | 数値   | ○    | 移動先のy座標 |
|   　　atk     | オブジェクト |      |               |
|     　　　x     | 数値   | ○    | 攻撃先のx座標 |
|     　　　y     | 数値   | ○    | 攻撃先のy座標 |

```
{
    "turn_team": "A",
    "contents": [
        {
            "unit_id": "A00",
            "to": {
                "x": 14,
                "y": 0
            },
            "atk": {
                "x": 14,
                "y": 0
            }
        }
    ]
}
```

### 名前JSON (Name JSON)
| JSON key  | 型     | 必須 | 値の説明      |
|-----------|--------|------|---------------|
| team_name | 文字列 | ○    | チーム名      |

```
{"team_name": "foo"}
```

## サーバが送信するもの
### 盤面JSON (Board Json)
| JSON key    | 型           | 必須 | 値の説明                                                        |
|-------------|--------------|------|-----------------------------------------------------------------|
| width       | 数値         | ○    | 盤面の幅                                                        |
| height      | 数値         | ○    | 盤面の高さ                                                      |
| turn_team   | 文字列       | ○    | 次のターンのチーム（次に行動内容を送信すべきチーム）            |
| players     | 配列         | ○    | 参加チーム名                                                    |
|   　team_name | 文字列       | ○    | クライアントが指定したチーム名                                  |
| finished    | 真偽値       | ○    | ゲーム終了時にtrue                                              |
| count       | 数値         | ○    | ターンの回数（例えば、双方が初回の行動を終えた場合は2と数える） |
| units       | 配列         | ○    | 盤面にあるユニット情報                                          |
|   　type      | 文字列       | ○    | コマの種類(今は“heis”しか使わない)                              |
|   　unit_id   | 文字列       | ○    | ゲームで使用するユニットでユニークな番号                        |
|   　locate    | オブジェクト | ○    |                                                                 |
|     　　x       | 数値         | ○    | ユニットのx座標                                                 |
|     　　y       | 数値         | ○    | ユニットのy座標                                                 |
|   　hp        | 数値         | ○    | 残りのHP                                                        |
|   　team      | 文字列       | ○    | ユニットが属するチーム名                                        |

```
{
    "width": 20,
    "height": 20,
    "turn_team": "A",
    "count": 2,
    "finished": false,
    "players": [
      {“team_name”: "foo"},
      { “team_name”: "goo"}
    ],
    "units": [
        {
            "type": "heis",
            "unit_id": "fo00",
            "locate": {
                "x": 13,
                "y": 1
            },
            "hp": 2,
            "team": "foo"
        },
        {
            "type": "heizu",
            "unit_id": "fo01",
            "locate": {
                "x": 13,
                "y": 0
            },
            "hp": 2,
            "team": "foo"
        }
    ]
}
```
### 結果JSON (Result JSON)
| JSON key    | 型           | 必須 | 値の説明                                                        |
|-------------|--------------|------|-----------------------------------------------------------------|
| result      | 配列         | ○    |                                                                 |
|   　unit_id   | 数値         |      | エラー対象のユニットのid                                        |
|   　error     | 文字列       | ○    | エラー内容                                                      |

```
{
    "result": [
        {
            "unit_id": "A00",
            "error": "json format error"
        }
    ]
}
```

### 名前確定JSON (Confirm Name JSON)
| JSON key  | 型     | 必須 | 値の説明      |
|-----------|--------|------|---------------|
| your_team | 文字列 | ○    | チーム名      |

```
{"your_team": "foo"}
```

### メッセージJSON (Message JSON)
| JSON key    | 型           | 必須 | 値の説明                                                        |
|-------------|--------------|------|-----------------------------------------------------------------|
| message     | 文字列       | ○    | メッセージの内容(今は名前要求のみで使用)                        |
```
{"message": "send your team_name."}
```